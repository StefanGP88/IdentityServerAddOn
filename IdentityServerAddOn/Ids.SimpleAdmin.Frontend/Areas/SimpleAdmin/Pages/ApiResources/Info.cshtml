@page "{id:int?}"
@model Ids.SimpleAdmin.Frontend.Areas.SimpleAdmin.Pages.ApiResources.InfoModel
@{
    Layout = "_NestedInfoLayout";
    var userClaimsDisplay = "User Claims";
    var userClaims = userClaimsDisplay.ToLowerNoSpaces();

    var propertiesDisplay = "Properties";
    var properties = propertiesDisplay.ToLowerNoSpaces();

    var scopesDisplay = "Scopes";
    var scopes = scopesDisplay.ToLowerNoSpaces();

    var secretsDisplay = "Secrets";
    var secrets = secretsDisplay.ToLowerNoSpaces();
}

@section NavTabs{
    <a class="nav-item nav-link" id="@(userClaims)tab" data-toggle="tab" href="#@userClaims" role="tab">@userClaimsDisplay</a>
    <a class="nav-item nav-link" id="@(properties)tab" data-toggle="tab" href="#@properties" role="tab">@propertiesDisplay</a>
    <a class="nav-item nav-link" id="@(scopes)tab" data-toggle="tab" href="#@scopes" role="tab">@scopesDisplay</a>
    <a class="nav-item nav-link" id="@(secrets)tab" data-toggle="tab" href="#@secrets" role="tab">@secretsDisplay</a>
}

@section Basesettings{
    <div class="form-group">
        <label class="col-form-label">Name</label>
        <input type="text" class="form-control" id="name" name="dto.Name" value="@Model?.Data?.Name">
        <partial name="_ValidationNotification" model="@ModelState["dto.Name"]" />
        <span asp-validation-for="Data.Name"></span>
    </div>
    <div class="form-group">
        <label class="col-form-label">Display name</label>
        <input type="text" class="form-control" id="displayName" name="dto.DisplayName" value="@Model?.Data?.DisplayName">
    </div>
    <div class="form-group">
        <label class="col-form-label">Description</label>
        <textarea class="form-control" id="description" name="dto.Description">@Model?.Data?.Description</textarea>
    </div>
    <div class="form-group">
        <label class="col-form-label">Allowed access token signing algorithmes</label>
        <textarea class="form-control" id="allowedAlgorithmes" name="dto.AllowedAccessTokenSigningAlgorithms">@Model?.Data?.AllowedAccessTokenSigningAlgorithms</textarea>
    </div>
    <fieldset class="form-group">
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="enabled" name="dto.Enabled" value="True" @Model?.Data?.Enabled.IsChecked() />
            <label class="form-check-label">Is enabled</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="nonEditable" name="dto.NonEditable" value="True" @Model?.Data?.NonEditable.IsChecked() />
            <label class="form-check-label">Is non-editable</label>
        </div>
        <div class="form-check">
            <input type="checkbox" class="form-check-input" id="showInDiscovery" name="dto.ShowInDiscoveryDocument" value="True" @Model?.Data?.ShowInDiscoveryDocument.IsChecked() />
            <label class="form-check-label">Show in discovery document</label>
        </div>
    </fieldset>
}

@section ResourceProperties{
    <div class="tab-pane fade" id="@userClaims" role="tabpanel">
        <br />
        <table class="table table-striped border border-dark">
            <partial name="_Tableheader" model="@(new List<string> {"Type"})" />
            @{RenderTableBody(userClaims, Model?.Data?.UserClaims);}
        </table>
        <button type="button" class="btn btn-primary" form="#" onclick="AppendTableRow('@userClaims', '@userClaims.AsTableBody()')"></button>
    </div>
    <div class="tab-pane fade" id="@properties" role="tabpanel">
        <br />
        <table class="table table-striped border border-dark">
            <partial name="_Tableheader" model="@(new List<string> { "Value", "Key" })" />
            @{RenderTableBody(properties, Model?.Data?.Properties);}
        </table>
        <button type="button" class="btn btn-primary" form="#" onclick="AppendTableRow('@properties', '@properties.AsTableBody()')"></button>
    </div>
    <div class="tab-pane fade" id="@scopes" role="tabpanel">
        <br />
        <table class="table table-striped border border-dark">
            <partial name="_Tableheader" model="@(new List<string> { "Scope"})" />
            @{RenderTableBody(scopes, Model?.Data?.Scopes);}
        </table>
        <button type="button" class="btn btn-primary" form="#" onclick="AppendTableRow('@scopes', '@scopes.AsTableBody()')"></button>
    </div>
    <div class="tab-pane fade" id="@secrets" role="tabpanel">
        <br />
        <table class="table table-striped border border-dark">
            <partial name="_Tableheader" model="@(new List<string> { "Type", "Value", "Description", "Expiration"})" />
            @{RenderTableBody(secrets, Model?.Data?.Secrets);}
        </table>
        <button type="button" class="btn btn-primary" form="#" onclick="AppendTableRow('@secrets', '@secrets.AsTableBody()')"></button>
    </div>
}


@functions {
    private void RenderTableBody<T>(string name, List<T> list)
    {
        <tbody id="@name.AsTableBody()">
            @if (list != null)
            {
                foreach (var item in list)
                {
                    Html.RenderPartialAsync("TableRowPartials/_" + name.FirstLetterToUpper(), item);
                }
            }
        </tbody>
    }
}